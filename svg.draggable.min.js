// svg.draggable.js 0.1.0 - Copyright (c) 2014 Wout Fierens - Licensed under the MIT license
;(function(){SVG.extend(SVG.Element,{draggable:function(o){var t,n,e,a,i,s,r=this,h=this.parent._parent(SVG.Nested)||this._parent(SVG.Doc),d="ontouchstart"in window||navigator.msMaxTouchPoints&&!navigator.msPointerEnabled;return"function"==typeof this.fixed&&this.fixed(),d?(a="touchstart",i="touchmove",s="touchend"):(a="mousedown",i="mousemove",s="mouseup"),o=o||{},t=function(o){o=o||window.event,r.beforedrag&&r.beforedrag(o);var t=r.bbox();r instanceof SVG.G?(t.x=r.x(),t.y=r.y()):r instanceof SVG.Nested&&(t={x:r.x(),y:r.y(),width:r.width(),height:r.height()}),r.startEvent=o,r.startPosition={x:t.x,y:t.y,width:t.width,height:t.height,zoom:h.viewbox().zoom,rotation:r.transform("rotation")*Math.PI/180,pageX:o.changedTouches?o.changedTouches[0].pageX:o.pageX,pageY:o.changedTouches?o.changedTouches[0].pageY:o.pageY},SVG.on(window,i,n),SVG.on(window,s,e),r.dragstart&&r.dragstart({x:0,y:0,zoom:r.startPosition.zoom},o),o.preventDefault?o.preventDefault():o.returnValue=!1},n=function(t){if(t=t||window.event,r.startPosition){var n,e,a=r.startPosition.rotation,i=r.startPosition.width,s=r.startPosition.height,h=(r.startPosition.pageX,r.startPosition.pageY,t.changedTouches?t.changedTouches[0]:t),d={x:h.pageX-r.startPosition.pageX,y:h.pageY-r.startPosition.pageY,zoom:r.startPosition.zoom};if(n=r.startPosition.x+(d.x*Math.cos(a)+d.y*Math.sin(a))/r.startPosition.zoom,e=r.startPosition.y+(d.y*Math.cos(a)+d.x*Math.sin(-a))/r.startPosition.zoom,"function"==typeof o){var g=o(n,e);"object"==typeof g?(("boolean"!=typeof g.x||g.x)&&r.x("number"==typeof g.x?g.x:n),("boolean"!=typeof g.y||g.y)&&r.y("number"==typeof g.y?g.y:e)):"boolean"==typeof g&&g&&r.move(n,e)}else"object"==typeof o&&(null!=o.minX&&n<o.minX?n=o.minX:null!=o.maxX&&n>o.maxX-i&&(n=o.maxX-i),null!=o.minY&&e<o.minY?e=o.minY:null!=o.maxY&&e>o.maxY-s&&(e=o.maxY-s),r.move(n,e));r.dragmove&&r.dragmove(d,t)}},e=function(o){o=o||window.event;var t=o.changedTouches?o.changedTouches[0]:o,a={x:t.pageX-r.startPosition.pageX,y:t.pageY-r.startPosition.pageY,zoom:r.startPosition.zoom};r.startEvent=null,r.startPosition=null,SVG.off(window,i,n),SVG.off(window,s,e),r.dragend&&r.dragend(a,o)},r.on(a,t),r.fixed=function(){return r.off("mousedown",t),SVG.off(window,i,n),SVG.off(window,s,e),t=n=e=null,r},this}})}).call(this);